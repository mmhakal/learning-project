{% extends 'layouts/boilerplate.html' %}

{% block title %}All Listings{% endblock %}

{% block content %}

<style>
  :root {
    --bg-card: #0b0e1a;
    --border-subtle: #232742;
    --accent: #00ff90;
    --accent-2: #ff2768;
    --text-main: #ffffff;
    --text-muted: #a4a8c3;
  }

  body {
    background:
      radial-gradient(circle at top, #171a33 0, #050711 55%) fixed,
      #050711;
    color: var(--text-main);
  }

  /* PAGE HEADER */
  .list-header h2 {
    font-weight: 600;
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .neon-bar {
    width: 20px;
    height: 3px;
    border-radius: 999px;
    background: linear-gradient(90deg, var(--accent-2), var(--accent));
    animation: glow 2s infinite alternate;
  }

  @keyframes glow {
    0% { box-shadow: 0 0 5px rgba(0,255,144,.3); }
    100% { box-shadow: 0 0 16px rgba(0,255,144,1); }
  }

  /* SEARCH BAR */
  .search-input {
    background: #0d1022;
    border: 1px solid var(--border-subtle);
    color: var(--text-main);
    padding: 10px 14px;
    border-radius: 12px 0 0 12px;
  }

  .search-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 10px rgba(0,255,144,.4);
  }

  .search-btn {
    background: linear-gradient(90deg, var(--accent), #00b165);
    border: none;
    color: black;
    font-weight: 600;
    padding: 0 20px;
    border-radius: 0 12px 12px 0;
  }

  /* LISTING CARD */
  .card-listing {
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: 16px;
    overflow: hidden;
    transition: .25s ease;
    box-shadow: 0 0 18px rgba(0,0,0,0.25);
  }

  .card-listing:hover {
    transform: translateY(-5px);
    border-color: var(--accent);
    box-shadow: 0 0 30px rgba(0,255,144,.25);
  }

  .card-listing-body {
    padding: 14px;
  }

  .card-listing-title {
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .card-listing-desc {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 8px;
  }

  .card-listing-price {
    font-size: 1rem;
    color: var(--accent);
    font-weight: 600;
  }

  .btn-outline-primary,
  .btn-outline-secondary,
  .btn-outline-danger {
    border-radius: 10px;
  }

  .pagination .page-link {
    background: #090c18;
    border: 1px solid #2d3250;
    color: var(--text-main);
    border-radius: 10px;
  }

  .pagination .active .page-link {
    background: var(--accent);
    color: black;
    border-color: var(--accent);
  }

</style>

<!-- PAGE HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4 list-header">
    <h2>
      <span class="neon-bar"></span>
      All Listings
    </h2>

    {% if is_admin %}
        <a href="{{ url_for('listing.new') }}" class="btn btn-success">
            + New Listing
        </a>
    {% endif %}
</div>

<!-- SEARCH -->
<form method="GET" action="{{ url_for('listing.index') }}" class="mb-4">
  <div class="input-group">
      <input type="text" name="q" class="form-control search-input"
             placeholder="Search listings..."
             value="{{ q or '' }}">
      <button class="search-btn">Search</button>
  </div>
</form>

<!-- LISTINGS -->
{% if listings %}
<div class="row">

    {% for listing in listings %}
    <div class="col-md-4 col-sm-6 mb-4">

        <div class="card-listing">

            <a href="{{ url_for('listing.show', id=listing.id) }}">
                <img src="{{ listing.image_url or 'https://via.placeholder.com/600x400?text=No+Image' }}"
                     class="img-fluid" alt="{{ listing.title }}">
            </a>

            <div class="card-listing-body">

                <div class="card-listing-title">{{ listing.title }}</div>
                <div class="card-listing-desc">{{ listing.description[:100] }}...</div>

                {% if listing.price %}
                <div class="card-listing-price">₹ {{ listing.price }}</div>
                {% endif %}

                <div class="mt-2 d-flex gap-2">

                    <a href="{{ url_for('listing.show', id=listing.id) }}"
                       class="btn btn-sm btn-outline-primary">View</a>

                    {% if is_admin %}
                      <a href="{{ url_for('listing.edit', id=listing.id) }}"
                         class="btn btn-sm btn-outline-secondary">Edit</a>

                      <form method="POST"
                            action="{{ url_for('listing.delete', id=listing.id) }}"
                            class="d-inline">
                        <button class="btn btn-sm btn-outline-danger"
                                onclick="return confirm('Delete this listing?')">
                          Delete
                        </button>
                      </form>
                    {% endif %}
                </div>

            </div>
        </div>
    </div>
    {% endfor %}

</div>

{% else %}
  {% if q %}
    <p class="text-muted">No listings found for "<strong>{{ q }}</strong>".</p>
  {% else %}
    <p>No listings created yet.</p>
  {% endif %}
{% endif %}

<!-- PAGINATION -->
{% if pagination.pages > 1 %}
<nav class="mt-4">
    <ul class="pagination justify-content-center">

        <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
            <a class="page-link"
               href="{{ url_for('listing.index', page=pagination.prev_num, q=q) }}">Previous</a>
        </li>

        {% for p in pagination.iter_pages(left_edge=1, right_edge=1,
                                          left_current=2, right_current=2) %}
            {% if p %}
                <li class="page-item {% if p == pagination.page %}active{% endif %}">
                    <a class="page-link"
                       href="{{ url_for('listing.index', page=p, q=q) }}">
                        {{ p }}
                    </a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">…</span></li>
            {% endif %}
        {% endfor %}

        <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
            <a class="page-link"
               href="{{ url_for('listing.index', page=pagination.next_num, q=q) }}">Next</a>
        </li>

    </ul>
</nav>
{% endif %}

{% endblock %}
