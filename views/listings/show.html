{% extends 'layouts/boilerplate.html' %}

{% block title %}{{ listing.title }}{% endblock %}

{% block content %}

<style>
  :root {
    --bg-card: #0b0e1a;
    --border-subtle: #232742;
    --accent: #00ff90;
    --accent-2: #ff2768;
    --text-main: #ffffff;
    --text-muted: #a4a8c3;
  }

  body {
    background:
      radial-gradient(circle at top, #171a33 0, #050711 55%) fixed,
      #050711;
    color: var(--text-main);
  }

  /* MAIN IMAGE */
  .listing-img {
    border-radius: 18px;
    border: 1px solid var(--border-subtle);
    box-shadow: 0 0 22px rgba(0,255,144,.1);
    transition: .3s ease;
  }
  .listing-img:hover {
    transform: scale(1.01);
    box-shadow: 0 0 35px rgba(0,255,144,.3);
  }

  /* TITLE */
  .listing-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 700;
    font-size: 1.8rem;
    margin-top: 15px;
  }

  .title-glow {
    width: 24px;
    height: 3px;
    border-radius: 999px;
    background: linear-gradient(90deg, var(--accent-2), var(--accent));
    animation: glowLine 2s infinite alternate;
  }

  @keyframes glowLine {
    0% { box-shadow: 0 0 6px rgba(0,255,144,.3); }
    100% { box-shadow: 0 0 18px rgba(0,255,144,1); }
  }

  /* PRICE */
  .listing-price {
    font-size: 1.4rem;
    color: var(--accent);
    font-weight: 700;
  }

  /* REVIEW SECTIONS */
  .review-box {
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    padding: 18px;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0,255,144,.08);
    margin-bottom: 20px;
  }

  .review-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 12px;
  }

  .review-title-glow {
    width: 18px;
    height: 3px;
    border-radius: 999px;
    background: linear-gradient(90deg, var(--accent-2), var(--accent));
    animation: glowLine 2s infinite alternate;
  }

  .review-item {
    background: #0f1323;
    border: 1px solid #2e334d;
    border-radius: 10px;
    padding: 10px 12px;
    margin-bottom: 10px;
  }

  .review-item strong {
    color: var(--accent);
    display: block;
    margin-bottom: 2px;
    font-size: .9rem;
  }

  .review-item p {
    font-size: .85rem;
    color: var(--text-muted);
    margin: 0;
  }

  /* STAR RATING LEFT → RIGHT */
  .rating {
    display: flex;
    flex-direction: row;
    font-size: 1.6rem;
    gap: 6px;
  }
  .rating input { display: none; }

  .rating label {
    color: #444;
    cursor: pointer;
    transition: .2s;
  }

  /* No star pre-selected – only on hover / click */
  .rating input:checked ~ label,
  .rating label:hover,
  .rating label:hover ~ label {
    color: var(--accent);
    text-shadow: 0 0 10px rgba(0,255,144,.7);
  }

  /* BUTTONS */
  .btn-primary {
    background: linear-gradient(90deg, var(--accent), #00b165);
    border: none;
    border-radius: 12px;
    font-weight: 600;
  }

  .btn-primary:hover {
    transform: scale(1.03);
    box-shadow: 0 0 18px rgba(0,255,144,.4);
  }

  .btn-outline-secondary:hover {
    color: var(--accent);
    border-color: var(--accent);
  }

  .btn-outline-danger:hover {
    box-shadow: 0 0 15px rgba(255,0,0,.6);
  }

  textarea, input.form-control {
    background: #090b14;
    border: 1px solid var(--border-subtle);
    color: var(--text-main);
  }


</style>


<div class="row">

  <!-- LEFT COLUMN -->
  <div class="col-md-7">

    <img src="{{ listing.image_url or 'https://via.placeholder.com/900x500?text=No+Image' }}"
         class="img-fluid listing-img" alt="{{ listing.title }}">

    <h2 class="listing-title">
      <span class="title-glow"></span>
      {{ listing.title }}
    </h2>

    {% if listing.price %}
      <p class="listing-price">₹ {{ listing.price }}</p>
    {% endif %}

    <p class="mt-3">{{ listing.description }}</p>

    {% if is_admin %}
      <div class="mt-3 d-flex gap-2">

        <a href="{{ url_for('listing.edit', id=listing.id) }}"
           class="btn btn-outline-secondary btn-sm">Edit</a>

        <form method="POST"
              action="{{ url_for('listing.delete', id=listing.id) }}"
              class="d-inline">
          <button class="btn btn-outline-danger btn-sm"
                  onclick="return confirm('Delete listing?')">Delete</button>
        </form>

      </div>
    {% endif %}
  </div>


  <!-- RIGHT COLUMN -->
  <div class="col-md-5">

    <!-- ⭐ ADD REVIEW FIRST -->
    <div class="review-box">
      <div class="review-title">
        <span class="review-title-glow"></span>
        Add a Review
      </div>

      <form method="POST"
            action="{{ url_for('review.add_review', listing_id=listing.id) }}">

        <div class="mb-2">
          <label class="form-label">Name</label>
          <input type="text" name="username" class="form-control" required>
        </div>

        <div class="mb-2">
          <label class="form-label">Rating</label>
          <div class="rating">

            <!-- ⭐ No "checked" — default sab off -->
            <input type="radio" id="star5" name="rating" value="5">
            <label for="star5">★</label>

            <input type="radio" id="star4" name="rating" value="4">
            <label for="star4">★</label>

            <input type="radio" id="star3" name="rating" value="3">
            <label for="star3">★</label>

            <input type="radio" id="star2" name="rating" value="2">
            <label for="star2">★</label>

            <input type="radio" id="star1" name="rating" value="1">
            <label for="star1">★</label>

          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Comment</label>
          <textarea name="comment" rows="3" class="form-control" required></textarea>
        </div>

        <button class="btn btn-primary btn-sm">Submit Review</button>

      </form>
    </div>


    <!-- ⭐ REVIEWS BELOW (RATING TEXT HIDDEN) -->
    <div class="review-box">
      <div class="review-title">
        <span class="review-title-glow"></span>
        Reviews
      </div>

      {% if reviews %}
        {% for r in reviews %}
          <div class="review-item">
            <strong>{{ r.username }}</strong>
            <p>{{ r.comment }}</p>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-muted mb-0">No reviews yet. Be the first one to review!</p>
      {% endif %}
    </div>

  </div>

</div>

{% endblock %}
